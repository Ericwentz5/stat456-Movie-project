cnn <- nn_module(
initialize = function() {
self$conv1 <- nn_conv2d(1, 8, kernel_size = 3)
self$pool  <- nn_max_pool2d(kernel_size = 2)
self$conv2 <- nn_conv2d(8, 16, kernel_size = 3)
self$fc1   <- nn_linear(16*5*5, 10)
},
forward = function(x) {
x %>%
self$conv1() %>% nnf_relu() %>% self$pool() %>%
self$conv2() %>% nnf_relu() %>% self$pool() %>%
torch_flatten(start_dim = 2) %>%
self$fc1()
}
)
fitted <- cnn %>%
setup(
loss = nn_cross_entropy_loss(),
optimizer = optim_adam
) %>%
set_hparams() %>%
fit(train_dl, epochs = 3)
train_ds <- mnist_dataset(
root = "./data",
train = TRUE,
transform <- function(x) {
x <- torch_tensor(x, dtype = torch_float()) / 255  # turn numeric vector into tensor
x <- x$view(c(1, 28, 28))                          # reshape to [1, 28, 28]
x
},
download = TRUE
)
train_dl <- dataloader(train_ds, batch_size = 32, shuffle = TRUE)
batch <- train_dl$.iter()$.next()
transform <- function(x) {
x <- x$to(dtype = torch_float()) / 255
x
}
train_ds <- cifar10_dataset(
root = "./data",
train = TRUE,
download = TRUE,
transform = transform
)
train_dl <- dataloader(train_ds, batch_size = 64, shuffle = TRUE)
batch <- train_dl$.iter()$.next()
batch <- train_dl$.iter()$.next()
batch <- train_dl$.iter()$.next()
batch <- train_dl$.iter()$.next()
transform <- function(x) {
# x comes in as an atomic vector (length 3072 for CIFAR10)
# Convert vector -> tensor
x <- torch_tensor(as.numeric(x), dtype = torch_float())
# Normalize to 0‚Äì1
x <- x / 255
# CIFAR10 is 3 √ó 32 √ó 32 RGB = 3072 numbers
x <- x$view(c(3, 32, 32))
x
}
train_ds <- cifar10_dataset(
root = "./data",
train = TRUE,
download = TRUE,
transform = transform
)
train_dl <- dataloader(train_ds, batch_size = 64, shuffle = TRUE)
batch <- train_dl$.iter()$.next()
batch[[1]]$size()
cnn <- nn_module(
initialize = function() {
# Input: 3 channels ‚Üí Output: 16 feature maps
self$conv1 <- nn_conv2d(3, 16, kernel_size = 3, padding = 1)
self$pool  <- nn_max_pool2d(kernel_size = 2)
# Next layer: 16 ‚Üí 32 channels
self$conv2 <- nn_conv2d(16, 32, kernel_size = 3, padding = 1)
# Fully connected classifier
# After two 2√ó2 pools: 32√ó8√ó8 = 2048 features
self$fc1 <- nn_linear(32 * 8 * 8, 10)
},
forward = function(x) {
x %>%
self$conv1() %>% nnf_relu() %>% self$pool() %>%
self$conv2() %>% nnf_relu() %>% self$pool() %>%
torch_flatten(start_dim = 2) %>%
self$fc1()
}
)
device <- torch_device("cpu")
fitted <- cnn %>%
setup(
loss = nn_cross_entropy_loss(),
optimizer = optim_adam,
device = device
) %>%
set_hparams() %>%
fit(train_dl, epochs = 3)
fitted <- cnn %>%
setup(
loss = nn_cross_entropy_loss(),
optimizer = optim_adam
) %>%
set_device(device) %>%   # ‚úîÔ∏è correct location
set_hparams() %>%
fit(train_dl, epochs = 3)
fitted <- cnn %>%
setup(
loss = nn_cross_entropy_loss(),
optimizer = optim_adam
) %>%
set_hparams() %>%
fit(train_dl, epochs = 3)
batch <- train_dl$.iter()$.next()
images <- batch[[1]]
labels <- batch[[2]]
logits <- fitted$predict(images)
fitted
batch <- train_dl$.iter()$.next()
images <- batch[[1]]
labels <- batch[[2]]
logits <- fitted$predict(images)
batch <- train_dl$.iter()$.next()
images <- batch[[1]]
labels <- batch[[2]]
logits <- predict(fitted, images)
preds <- logits$argmax(2)$squeeze()
acc <- mean((as.array(preds) == as.array(labels)))
acc
table(
Predicted = as.array(preds),
Actual    = as.array(labels)
)
knitr::opts_chunk$set(echo = TRUE, error=TRUE)
library(dplyr)
library(lubridate)
library(stringr)
library(ggplot2)
library(sf) #install.packages('sf')
library(spdep) #install.packages('spdep')
load('SpatialData.RData')
head(ramsey_data)
# View(CodeBook) to see original descriptions from tidycensus
View(CodeBook)
View(areawater)
View(CodeBook)
View(ramsey_data)
View(ramsey_data)
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warnings=FALSE)
ramsey_data %>% ggplot() +
geom_sf(aes(fill = `HouseType_Owner occupied`)) +
labs(fill = 'Residuals') +
scale_fill_gradient2(mid = "white", high = "red", low = "blue") + theme_classic()
ramsey_data %>%
ggplot() +
geom_sf(aes(fill = `HouseType_Owner occupied`)) +
scale_fill_viridis_c(option = "C") +
labs(fill = "Owner Occupied (%)") +
theme_classic()
input <- map_df(input_files, read_csv)
library(janitor)
data_path <- "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/nfl_data/train"
input_files <- list.files(
path = data_path,
pattern = "^input_2023",
full.names = TRUE
)
input <- map_df(input_files, read_csv)
library(tidyverse)
library(janitor)
library(purrr)
data_path <- "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/nfl_data/train"
input_files <- list.files(
path = data_path,
pattern = "^input_2023",
full.names = TRUE
)
input <- map_df(input_files, read_csv)
View(input)
test_game_id <- 2023090700
input_game <- input %>%
filter(game_id == test_game_id)
save(input_game, file = 'SpatialData.RData')
save(input_game, output_game,
file = "test_game_tracking.RData"))
save(input_game, output_game,
file = "test_game_tracking.RData")
save(input_game,
file = "test_game_tracking.RData")
getwd()
save(input_game,
file = "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/test_game_tracking.RData")
load(lions_chiefs_w1.RData)
getwd()
setwd("~/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric")
load(lions_chiefs_w1.RData)
getwd()
load("lions_chiefs_w1.RData")
library(nflfastR)
pbp_2023 <- load_pbp(2023)
View(pbp_2023)
library(dplyr)
lions_chiefs_pass <- pbp_2023 %>%
filter(game_id = test_game_id) %>%
filter(play_type = pass)
lions_chiefs_pass <- pbp_2023 %>%
filter(game_id == test_game_id) %>%
filter(play_type == pass)
test_game_id <- 2023090700
lions_chiefs_pass <- pbp_2023 %>%
filter(game_id == test_game_id) %>%
filter(play_type == pass)
View(lions_chiefs_pass)
lions_chiefs_pass <- pbp_2023 %>%
filter(game_id == test_game_id)
lions_chiefs_pass <- pbp_2023 %>%
filter(game_id == test_game_id)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == pass)
pbp_2023 <- load_pbp(2023)
test_game_id <- 2023090700
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == pass)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == pass)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id)
View(lions_chiefs_pass)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == "pass")
View(lions_chiefs_pass)
lions_chiefs_pass %>%
select(game_id, play_id, yards_gained, complete_pass, pass_touchdown, epa, air_epa,
yac_epa, pass_length, pass_location, air_yards, receiver, passer)
lions_chiefs_pass <- lions_chiefs_pass %>%
select(game_id, play_id, yards_gained, complete_pass, pass_touchdown, epa, air_epa,
yac_epa, pass_length, pass_location, air_yards, receiver, passer)
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id", "play_id")
)
# Get one game of plays
data_path <- "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/nfl_data/train"
input_files <- list.files(
path = data_path,
pattern = "^input_2023",
full.names = TRUE
)
input <- map_df(input_files, read_csv)
test_game_id <- 2023090700
input_game <- input %>%
filter(game_id == test_game_id)
save(input_game,
file = "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/test_game_tracking.RData")
#---------------------------
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id", "play_id")
)
View(input_game)
View(lions_chiefs_pass)
lions_chiefs_pass <- lions_chiefs_pass %>%
select(old_game_id, play_id, yards_gained, complete_pass, pass_touchdown, epa, air_epa,
yac_epa, pass_length, pass_location, air_yards, receiver, passer)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == "pass")
lions_chiefs_pass <- lions_chiefs_pass %>%
select(old_game_id, play_id, yards_gained, complete_pass, pass_touchdown, epa, air_epa,
yac_epa, pass_length, pass_location, air_yards, receiver, passer)
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("old_game_id" = "game_id",
"play_id" = "play_id")
)
View(lions_chiefs_pass)
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id" = "old_game_id",
"play_id" = "play_id")
)
input_game <- input_game %>%
mutate(game_id = as.character(game_id))
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id" = "old_game_id",
"play_id" = "play_id")
)
View(lions_chiefs_pass)
save(lions_chiefs_merged,
file = "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/test_game_tracking.RData")
load("lions_chiefs_w1.RData")
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id" = "old_game_id",
"play_id" = "play_id")
)
library(tidyverse)
library(janitor)
library(purrr)
# Get one game of plays
data_path <- "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/nfl_data/train"
input_files <- list.files(
path = data_path,
pattern = "^input_2023",
full.names = TRUE
)
input <- map_df(input_files, read_csv)
test_game_id <- 2023090700
input_game <- input %>%
filter(game_id == test_game_id)
# add pbp data from nfl fast R
library(nflfastR)
library(dplyr)
pbp_2023 <- load_pbp(2023)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == "pass")
lions_chiefs_pass <- lions_chiefs_pass %>%
select(old_game_id, play_id, yards_gained, complete_pass, pass_touchdown, epa, air_epa,
yac_epa, pass_length, pass_location, air_yards, receiver, passer)
input_game <- input_game %>%
mutate(game_id = as.character(game_id))
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id" = "old_game_id",
"play_id" = "play_id")
)
save(lions_chiefs_merged,
file = "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/test_game_tracking.RData")
load("lions_chiefs_w1.RData")
save(lions_chiefs_merged,
file = "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/lions_chiefs_w1.RData")
#---------------------------
#---------------------------
#---------------------------
library(tidyverse)
library(janitor)
library(purrr)
# Get one game of plays
data_path <- "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/nfl_data/train"
input_files <- list.files(
path = data_path,
pattern = "^input_2023",
full.names = TRUE
)
input <- map_df(input_files, read_csv)
test_game_id <- 2023090700
input_game <- input %>%
filter(game_id == test_game_id)
# add pbp data from nfl fast R
library(nflfastR)
library(dplyr)
pbp_2023 <- load_pbp(2023)
lions_chiefs_pass <- pbp_2023 %>%
filter(old_game_id == test_game_id) %>%
filter(play_type == "pass")
lions_chiefs_pass <- lions_chiefs_pass %>%
select(old_game_id, play_id, yards_gained, complete_pass, pass_touchdown, epa, air_epa,
yac_epa, pass_length, pass_location, air_yards, receiver, passer)
input_game <- input_game %>%
mutate(game_id = as.character(game_id))
lions_chiefs_merged <- input_game %>%
left_join(
lions_chiefs_pass,
by = c("game_id" = "old_game_id",
"play_id" = "play_id")
)
save(lions_chiefs_merged,
file = "/Users/ericwentz/Desktop/Mac_Code/STAT_452/Capstone_NFL/capstone-project-capstone-kynan-eric/lions_chiefs_w1.RData")
#---------------------------
load("lions_chiefs_w1.RData")
View(lions_chiefs_merged)
View(lions_chiefs_merged)
setwd("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/wentz_Viz_capstone")
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
setwd("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/wentz_Viz_capstone")
library(readr)
X10k_pre_2010_01_01_w_llm_classification <- read_csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
View(X10k_pre_2010_01_01_w_llm_classification)
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
View(llm_movie_class)
View(tmdb_5000)
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "original title")
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "original_title")
View(full_movie_data)
View(tmdb_5000)
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "title")
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "title")
View(tmdb_5000)
llm_movie_class <- unique(llm_movie_class)
View(llm_movie_class)
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
View(llm_movie_class)
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "title")
View(full_movie_data)
duplicates<- duplicated(full_movie_data$title)
print(duplicates)
duplicates<- sum(duplicated(full_movie_data$title))
print(duplicates)
duplicates<- df[duplicated(full_movie_data$title),]
duplicates<- df[duplicated(full_movie_data$title), ]
any(duplicated(full_movie_data$title))
duplicates <- full_movie_data$title[duplicated(full_movie_data$title)]
duplicates
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
full_movie_data <- full_movie_data %>%
select(adult, keywords, overview.y, release_date.y, genres)
View(full_movie_data)
full_movie_data <- full_movie_data %>%
select(adult, keywords, overview.y, release_date.y, genres, title)
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "title")
full_movie_data <- full_movie_data %>%
select(adult, keywords, overview.y, release_date.y, genres, title)
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "title")
View(full_movie_data)
View(tmdb_5000)
View(full_movie_data)
View(full_movie_data)
full_movie_data <- full_movie_data %>%
select(adult, keywords, overview.y, release_date.y, genres, title)
View(full_movie_data)
View(tmdb_5000)
View(full_movie_data)
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
full_movie_data <- llm_movie_class %>%
left_join(tmdb_5000, by = "title")
View(full_movie_data)
# Before distinct (re-read the file to reset)
llm_raw <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
nrow(llm_raw)
sum(!is.na(llm_raw$keywords))
llm_movie_class <- llm_raw %>%
distinct(title, .keep_all = TRUE)
nrow(llm_movie_class)
sum(!is.na(llm_movie_class$keywords))
# Before distinct (re-read the file to reset)
llm_raw <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
nrow(llm_raw)
sum(!is.na(llm_raw$keywords))
llm_movie_class <- llm_raw %>%
distinct(title, .keep_all = TRUE)
nrow(llm_movie_class)
sum(!is.na(llm_movie_class$keywords))
nrow(full_movie_data)
sum(!is.na(full_movie_data$keywords))
# üîÅ Recreate your LLM data (same as before distinct + join)
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
# üéØ Titles that had keywords before the join
titles_with_keywords_before <- llm_movie_class %>%
filter(!is.na(keywords)) %>%
pull(title)
# üîÅ Recreate your LLM data (same as before distinct + join)
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
# üéØ Titles that had keywords before the join
titles_with_keywords_before <- tmdb_5000 %>%
filter(!is.na(keywords)) %>%
pull(title)
length(titles_with_keywords_before)  # how many had keywords originally?
# üéØ Titles that still have keywords in the final data
titles_with_keywords_after <- full_movie_data %>%
filter(!is.na(keywords)) %>%
pull(title)
length(titles_with_keywords_after)   # how many still have them?
# ‚ùå Titles that had keywords before but DON'T now
lost_keyword_titles <- setdiff(titles_with_keywords_before, titles_with_keywords_after)
length(lost_keyword_titles)          # how many lost them?
lost_keyword_titles[1:20]            # peek at the first few
View(tmdb_5000)
sum(tmdb_5000$keywords == "[]", na.rm = TRUE)
