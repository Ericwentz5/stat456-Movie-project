labels = c("Loss", "Win"))
)
league_avg_oreb <- mean(c(Toms_Adv_thru_dec9$ORB,
opponent_Adv_thru_dec9$ORB),
na.rm = TRUE)
ggplot(oreb_summary, aes(x = team, y = oreb, fill = win)) +
geom_bar(stat = "identity", position = "dodge") +
geom_hline(
yintercept = league_avg_oreb,
linetype = "dotted",
color = "red",
size = 1
) +
labs(
title = "Average OREB% by Outcome",
subtitle = "St. Thomas vs Opponents | Dotted line = Overall Average",
x = "Team",
y = "Average OREB%",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "red", "Win" = "forestgreen")) +
theme_minimal(base_size = 14)
ggplot(oreb_summary, aes(x = team, y = oreb, fill = win)) +
geom_bar(stat = "identity", position = "dodge") +
geom_hline(
yintercept = league_avg_oreb,
linetype = "dotted",
color = "yellow",
size = 1
) +
labs(
title = "Average OREB% by Outcome",
subtitle = "St. Thomas vs Opponents | Dotted line = Overall Average",
x = "Team",
y = "Average OREB%",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "black", "Win" = "purple")) +
theme_minimal(base_size = 14)
ggplot(oreb_summary, aes(x = team, y = oreb, fill = win)) +
geom_bar(stat = "identity", position = "dodge") +
geom_hline(
yintercept = league_avg_oreb,
linetype = "dotted",
color = "yellow",
size = 1
) +
labs(
title = "Average OREB% by Outcome",
subtitle = "St. Thomas vs Opponents | Dotted line = Overall Average",
x = "Team",
y = "Average OREB%",
fill = "Game Result"
) +
scale_fill_manual(values = c("Tommies Loss" = "black", "Tommies Win" = "purple")) +
theme_minimal(base_size = 14)
ggplot(oreb_summary, aes(x = team, y = oreb, fill = win)) +
geom_bar(stat = "identity", position = "dodge") +
geom_hline(
yintercept = league_avg_oreb,
linetype = "dotted",
color = "yellow",
size = 1
) +
labs(
title = "Average OREB% by Outcome",
subtitle = "St. Thomas vs Opponents | Dotted line = Overall Average",
x = "Team",
y = "Average OREB%",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "black", "Win" = "purple")) +
theme_minimal(base_size = 14)
ggplot(oreb_summary, aes(x = team, y = oreb, fill = win)) +
geom_bar(stat = "identity", position = "dodge") +
geom_hline(
yintercept = league_avg_oreb,
linetype = "dotted",
color = "yellow",
size = 1
) +
labs(
title = "Average OREB% by Tommies' Outcomes",
subtitle = "St. Thomas vs Opponents | Dotted line = Overall Average",
x = "Team",
y = "Average OREB%",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "black", "Win" = "purple")) +
theme_minimal(base_size = 14)
ggplot(stm_all, aes(x = EFG, fill = win)) +
geom_density(alpha = 0.6) +
geom_vline(
xintercept = league_avg$efg_avg,
linetype = "dotted",
color = "black",
size = 1
) +
facet_wrap(~team_type, nrow = 1) +
labs(
title = "Effective FG% Distribution: St. Thomas vs Opponents",
subtitle = "Faceted by team — Dotted line = Overall Average EFG%",
x = "Effective FG%",
y = "Density",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "black", "Win" = "purple")) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
strip.text = element_text(size = 13, face = "bold")
)
Toms_Adv_thru_dec9 <- Toms_Adv_thru_dec9 %>%
mutate(team_type = "team")
opponent_Adv_thru_dec9 <- opponent_Adv_thru_dec9 %>%
mutate(team_type = "opponent")
opponent_Adv_thru_dec9 <- opponent_Adv_thru_dec9 %>%
mutate(
team_type = "Opponent",
result = Toms_Adv_thru_dec9$result   # MATCH ST. THOMAS RESULT
)
stm_all <- bind_rows(Toms_Adv_thru_dec9, opponent_Adv_thru_dec9)
stm_all <- stm_all %>%
mutate(team_type = if_else(team_type == "team", "St. Thomas", "Opponent"))
league_avg <- stm_all %>%
summarize(efg_avg = mean(EFG, na.rm = TRUE))
ggplot(stm_all, aes(x = EFG, fill = win)) +
geom_density(alpha = 0.6) +
geom_vline(
xintercept = league_avg$efg_avg,
linetype = "dotted",
color = "black",
size = 1
) +
facet_wrap(~team_type, nrow = 1) +
labs(
title = "Effective FG% Distribution: St. Thomas vs Opponents",
subtitle = "Faceted by team — Dotted line = Overall Average EFG%",
x = "Effective FG%",
y = "Density",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "black", "Win" = "purple")) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
strip.text = element_text(size = 13, face = "bold")
)
View(stm_all)
ggplot(stm_all, aes(x = EFG, fill = result)) +
geom_density(alpha = 0.6) +
geom_vline(
xintercept = league_avg$efg_avg,
linetype = "dotted",
color = "black",
size = 1
) +
facet_wrap(~team_type, nrow = 1) +
labs(
title = "Effective FG% Distribution: St. Thomas vs Opponents",
subtitle = "Faceted by team — Dotted line = Overall Average EFG%",
x = "Effective FG%",
y = "Density",
fill = "Game Result"
) +
scale_fill_manual(values = c("Loss" = "black", "Win" = "purple")) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
strip.text = element_text(size = 13, face = "bold")
)
View(Toms_Adv_thru_dec9)
dates <- as.Date(c(
"2025-11-03",
"2025-11-08",
"2025-11-14",
"2025-11-16",
"2025-11-21",
"2025-11-22",
"2025-11-26",
"2025-11-30",
"2025-12-03",
"2025-12-06"
))
dates <- rev(dates)
Toms_Adv_thru_dec9 <- Toms_Adv_thru_dec9 %>%
mutate(date = dates)
opponent_Adv_thru_dec9 <- opponent_Adv_thru_dec9 %>%
mutate(date = dates)
View(Toms_Adv_thru_dec9)
library(tidyverse)
ft_long <- Toms_Adv_thru_dec9 %>%
select(date, result, stt_ft = FT_rate) %>%
left_join(
opponent_Adv_thru_dec9 %>%
select(date, opp_ft = FT_rate),
by = "date"
) %>%
pivot_longer(
cols = c(stt_ft, opp_ft),
names_to = "team_type",
values_to = "ft_rate"
) %>%
mutate(
team_type = factor(
team_type,
levels = c("stt_ft", "opp_ft"),
labels = c("St. Thomas", "Opponent")
),
dot_color = if_else(result == "Win", "Win", "Loss")
)
ggplot(ft_long, aes(x = date, y = ft_rate, group = team_type, color = team_type)) +
# Lines
geom_line(size = 1.1, alpha = 0.7) +
# Dots (purple = win, black = loss)
geom_point(aes(fill = dot_color),
shape = 21,
color = "white",
size = 4,
stroke = 0.4) +
scale_color_manual(values = c("St. Thomas" = "purple",
"Opponent" = "gray40")) +
scale_fill_manual(values = c("Win" = "purple",
"Loss" = "black")) +
labs(
title = "FT Rate Over Time: St. Thomas vs Opponents",
subtitle = "Purple = Win | Black = Loss",
x = "Game Date",
y = "FT Rate",
color = "Team",
fill = "Game Result"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(ft_long, aes(x = date, y = ft_rate, group = team_type, color = team_type)) +
# Lines
geom_line(size = 1.1, alpha = 0.7) +
# Dots (using your color rules)
geom_point(aes(fill = dot_color),
shape = 21,
color = "white",
size = 4,
stroke = 0.4) +
scale_color_manual(values = c("St. Thomas" = "purple",
"Opponent" = "gray40")) +
scale_fill_identity() +  # <-- IMPORTANT: uses actual purple/black hex values
labs(
title = "FT Rate Over Time: St. Thomas vs Opponents",
subtitle = "St. Thomas: Purple in Wins | Opponent: Purple in Losses",
x = "Game Date",
y = "FT Rate",
color = "Team"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 45, hjust = 1)
)
ft_long <- Toms_Adv_thru_dec9 %>%
select(date, result, stt_ft = FT_rate) %>%
left_join(
opponent_Adv_thru_dec9 %>%
select(date, opp_ft = FT_rate),
by = "date"
) %>%
pivot_longer(
cols = c(stt_ft, opp_ft),
names_to = "team_type",
values_to = "ft_rate"
) %>%
mutate(
team_type = factor(team_type,
levels = c("stt_ft", "opp_ft"),
labels = c("St. Thomas", "Opponent")),
# DOT COLOR RULES:
dot_color = case_when(
result == "Win"  & team_type == "St. Thomas" ~ "purple",
result == "Win"  & team_type == "Opponent"   ~ "black",
result == "Loss" & team_type == "St. Thomas" ~ "black",
result == "Loss" & team_type == "Opponent"   ~ "purple"
)
)
ggplot(ft_long, aes(x = date, y = ft_rate, group = team_type, color = team_type)) +
# Lines
geom_line(size = 1.1, alpha = 0.7) +
# Dots (using your color rules)
geom_point(aes(fill = dot_color),
shape = 21,
color = "white",
size = 4,
stroke = 0.4) +
scale_color_manual(values = c("St. Thomas" = "purple",
"Opponent" = "gray40")) +
scale_fill_identity() +  # <-- IMPORTANT: uses actual purple/black hex values
labs(
title = "FT Rate Over Time: St. Thomas vs Opponents",
subtitle = "St. Thomas: Purple in Wins | Opponent: Purple in Losses",
x = "Game Date",
y = "FT Rate",
color = "Team"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 45, hjust = 1)
)
tov_long <- Toms_Adv_thru_dec9 %>%
select(date, result, stt_tov = TOV_rate) %>%
left_join(
opponent_Adv_thru_dec9 %>%
select(date, opp_tov = TOV_rate),
by = "date"
) %>%
pivot_longer(
cols = c(stt_tov, opp_tov),
names_to = "team_type",
values_to = "tov_rate"
) %>%
mutate(
team_type = factor(team_type,
levels = c("stt_tov", "opp_tov"),
labels = c("St. Thomas", "Opponent")),
# DOT COLOR LOGIC (same as FT Rate)
dot_color = case_when(
result == "Win"  & team_type == "St. Thomas" ~ "purple",
result == "Win"  & team_type == "Opponent"   ~ "black",
result == "Loss" & team_type == "St. Thomas" ~ "black",
result == "Loss" & team_type == "Opponent"   ~ "purple"
)
)
tov_long <- Toms_Adv_thru_dec9 %>%
select(date, result, stt_tov = TOV) %>%
left_join(
opponent_Adv_thru_dec9 %>%
select(date, opp_tov = TOV),
by = "date"
) %>%
pivot_longer(
cols = c(stt_tov, opp_tov),
names_to = "team_type",
values_to = "tov_rate"
) %>%
mutate(
team_type = factor(team_type,
levels = c("stt_tov", "opp_tov"),
labels = c("St. Thomas", "Opponent")),
# DOT COLOR LOGIC (same as FT Rate)
dot_color = case_when(
result == "Win"  & team_type == "St. Thomas" ~ "purple",
result == "Win"  & team_type == "Opponent"   ~ "black",
result == "Loss" & team_type == "St. Thomas" ~ "black",
result == "Loss" & team_type == "Opponent"   ~ "purple"
)
)
ggplot(tov_long, aes(x = date, y = tov_rate, group = team_type, color = team_type)) +
# lines
geom_line(size = 1.1, alpha = 0.7) +
# dots with win/loss reversal logic
geom_point(aes(fill = dot_color),
shape = 21,
color = "white",
size = 4,
stroke = 0.4) +
scale_color_manual(values = c("St. Thomas" = "purple",
"Opponent" = "gray40")) +
scale_fill_identity() +
labs(
title = "Turnover Rate Over Time: St. Thomas vs Opponents",
subtitle = "St. Thomas = Purple when winning | Opponent = Purple when St. Thomas loses",
x = "Game Date",
y = "TOV Rate",
color = "Team"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 45, hjust = 1)
)
ggplot(ft_long, aes(x = date, y = ft_rate, group = team_type, color = team_type)) +
# Lines
geom_line(size = 1.1, alpha = 0.7) +
# Dots (using your color rules)
geom_point(aes(fill = dot_color),
shape = 21,
color = "white",
size = 4,
stroke = 0.4) +
scale_color_manual(values = c("St. Thomas" = "purple",
"Opponent" = "gray40")) +
scale_fill_identity() +  # <-- IMPORTANT: uses actual purple/black hex values
labs(
title = "FT Rate Over Time: St. Thomas vs Opponents",
subtitle = "St. Thomas: Purple in Wins | Opponent: Purple in Losses",
x = "Game Date",
y = "FT Rate",
color = "Team"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 45, hjust = 1)
)
library(dplyr)
tmdb_5000 <- read.csv("tmdb_5000_movies.csv")
llm_movie_class <- read.csv("~/Desktop/Mac_Code/STAT_456/stat456-Movie-project/data/10k_pre-2010-01-01-w-llm-classification.csv")
llm_movie_class <- llm_movie_class %>%
distinct(title, .keep_all = TRUE)
full_movie_data <- tmdb_5000 %>%
full_join(llm_movie_class, by = "title")
full_movie_data <- full_movie_data %>%
select(adult, keywords, overview.y, release_date.y, genres, title, llm_class_final)
clean_data <- full_movie_data %>%
filter(!is.na(keywords) & !is.na(llm_class_final))
library(janitor)
clean_data <- clean_data %>%
rename(
overview = overview.y,
release_date = release_date.y,
cult_classic = llm_class_final
) %>%
clean_names()
parse_json_list <- function(x) {
if (is.na(x) || x == "[]" || x == "") return(NA)
# Convert escaped quotes \" to actual "
x_fixed <- gsub('\\"', '"', x)
# Parse JSON safely
out <- tryCatch({
jsonlite::fromJSON(x_fixed)$name
}, error = function(e) NA)
return(out)
}
movies_clean <- clean_data %>%
mutate(
genres_list = map(genres, parse_json_list),
keywords_list = map(keywords, parse_json_list)
)
clean_data <- full_movie_data %>%
filter(!is.na(keywords) & !is.na(llm_class_final))
library(janitor)
clean_data <- clean_data %>%
rename(
overview = overview.y,
release_date = release_date.y,
cult_classic = llm_class_final
) %>%
clean_names()
parse_json_list <- function(x) {
if (is.na(x) || x == "[]" || x == "") return(NA)
# Convert escaped quotes \" to actual "
x_fixed <- gsub('\\"', '"', x)
# Parse JSON safely
out <- tryCatch({
jsonlite::fromJSON(x_fixed)$name
}, error = function(e) NA)
return(out)
}
movies_clean <- clean_data %>%
mutate(
genres_list = map(genres, parse_json_list),
keywords_list = map(keywords, parse_json_list)
)
library(purrr)
movies_clean <- clean_data %>%
mutate(
genres_list = map(genres, parse_json_list),
keywords_list = map(keywords, parse_json_list)
)
movies_clean$keywords_list[1:5]
movies_clean <- clean_data %>%
mutate(
genres_list   = map(genres, clean_and_parse),
keywords_list = map(keywords, clean_and_parse)
)
movies_clean <- clean_data %>%
mutate(
genres_list   = map(genres, parse_json_list),
keywords_list = map(keywords, parse_json_list)
)
movies_clean %>%
unnest(genres_list) %>%
count(genres_list, sort = TRUE)
library(tidyverse)
movies_clean %>%
unnest(genres_list) %>%
count(genres_list, sort = TRUE)
movies_clean %>%
unnest(keywords_list) %>%
count(keywords_list, sort = TRUE)
movies_clean %>%
filter(cult_classic == 1) %>%
unnest(genres_list) %>%
count(genres_list, sort = TRUE)
cult_keywords <- movies_clean %>%
filter(cult_classic == 1) %>%
unnest(keywords_list) %>%
count(keywords_list, sort = TRUE)
print(cult_keywords)
genre_cult_heatmap <- movies_clean %>%
unnest(genres_list) %>%
count(cult_classic, genres_list) %>%
group_by(cult_classic) %>%
mutate(prop = n / sum(n)) %>%
mutate(cult_classic = ifelse(cult_classic == 1, "Cult", "Not Cult"))
ggplot(genre_cult_heatmap, aes(x = cult_classic, y = genres_list, fill = prop)) +
geom_tile(color = "white") +
scale_fill_gradient(low = "white", high = "red") +
labs(title = "Genre Proportions: Cult vs. Non-Cult Classics",
x = "Movie Type", y = "Genre", fill = "Proportion") +
theme_minimal(base_size = 14)
